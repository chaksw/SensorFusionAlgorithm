# Implement of EKF



### 矩阵$F$和$H$

与$KF$不同的是，EKF在预测和更新中，矩阵$F$和$H$为非线性模型，需要通过泰勒展开实现线性近似。但矩阵$F$和$H$是相互独立的，也就是说它们各自有进行泰勒展开的依据，矩阵$F$是否需要进行线性逼近取决于模型是否为非线性，而矩阵$H$是否需要进行线性逼近则取决于状态空间与观测空间之间的映射是否为直接的映射。

矩阵$F$描述马尔可夫过程中当前状态$k$到下一个状态$k+1$的状态转换，它反应的是状态是时间轴上的映射，如果本身运动为线性模型（如*nearly constant velocity*，*nearly constant acceleration*），则矩阵$F$可直接通过运动数学分析获得。

由于我们需要且只能通过传感器的测量值来获得物体的状态信息，在进行状态估计时，我们需要建立一个映射来表示状态空间与测量空间之间的关系。矩阵$H$就扮演了这样的角色。在测量空间中，测量值只会简单反应传感器的读数值（如该例中雷达的测量值径向距离，目标与本车的纵向角度以及径向速度），如果状态空间中的状态向量与传感器读数向量有直接对应的关系，那么矩阵$H$可直接通过常数项矩阵表示，但若如本例中，传感器读数与状态存在非线性映射关系，则需要根据多元泰勒展开求出对应的矩阵$H$。

### 代码思路

所有的代码实际上只是将数据模型翻译成计算机能够理解的模式，与$KF$相同，对EKF的implement在于建立相应的数学模型，即：

-   状态向量 $x$
-   外部控制向量 $u$
-   状态转移矩阵 $F$
-   系统噪声对应的协方差矩阵 $Q$
-   系统协方差矩阵 $P$
-   传感器读数向量 $z$
-   观测矩阵 $H$
-   测量误差对应的协方差矩阵 $R$

基本思路就是通过分析运动模型，定义时间更新和状态更新过程中的关系。比KF多一点的是，对于非线性映射，我们可能需要对矩阵$F$或者$H$，进行一些泰勒展开，求出雅可比矩阵形式。

在上述所有参数及求解形式都确定后，就可以进行预测+更新的步骤，求出相应的卡尔曼增益以及更新残差，继而求出最佳状态估计和协方差矩阵。

